"use strict";function hsvToRgb(h,s,v){function e(n){var e=(n+6*h)%6;return v-v*s*Math.max(0,Math.min(e,Math.min(4-e,1)))}return[255*e(5),255*e(3),255*e(1)]}function convertColor(browserSupportsP3,browserSupportsRec2020,r,g,b,a){return browserSupportsRec2020?`color(rec2020 ${r/255} ${g/255} ${b/255} / ${a??1})`:browserSupportsP3?`color(display-p3 ${r/255} ${g/255} ${b/255} / ${a??1})`:`rgba(${r}, ${g}, ${b}, ${a??1})`}const LITERAL=0,LAMBDA=1;function expressionToString({expression,addHtml=!0,darkTheme=!1,browserSupportsP3,browserSupportsRec2020}){var e=expression.startText??"",s=expression.endText??"",r=darkTheme?1:.7;if(expression.type===LITERAL){const p=expression.bindingLambda.literalColor,i=hsvToRgb(p.h,p.s,p.v*r),a=convertColor(browserSupportsP3,browserSupportsRec2020,...i);var o=expression.valueText;return expression.shorthandText?addHtml?`<span style="color: ${a}">${e.slice(1)}${expression.shorthandText}${s.slice(1)}</span>`:""+e.slice(1)+expression.shorthandText+s.slice(1):addHtml?`<span style="color: ${a}">${e}${o}${s}</span>`:""+e+o+s}if(expression.type===LAMBDA){o=expression.literalColor,o=convertColor(browserSupportsP3,browserSupportsRec2020,...hsvToRgb(o.h,o.s,o.v*r));const p=expression.color,i=hsvToRgb(p.h,p.s,p.v*r),a=convertColor(browserSupportsP3,browserSupportsRec2020,...i);var n=`Î»${expression.argumentText}.`,t=expressionToString({expression:expression.body,addHtml:addHtml,darkTheme:darkTheme});return expression.shorthandText?addHtml?`<span style="color: ${a}">${e.slice(1)}${expression.shorthandText}${s.slice(1)}</span>`:""+e.slice(1)+expression.shorthandText+s.slice(1):addHtml?`<span style="color: ${a}">${e}</span><span style="color: ${o}">${n}</span>${t}<span style="color: ${a}">${s}</span>`:e+n+t+s}o=expressionToString({expression:expression.function,addHtml:!1,darkTheme:darkTheme}),1<o.length&&"("!==o[0]&&(expression.function.startText="("+(expression.function.startText??""),expression.function.endText=(expression.function.endText??"")+")"),n=expressionToString({expression:expression.function,addHtml:addHtml,darkTheme:darkTheme}),t=expressionToString({expression:expression.input,addHtml:!1,darkTheme:darkTheme}),1<t.length&&"("!==t[0]&&(expression.input.startText="("+(expression.input.startText??""),expression.input.endText=(expression.input.endText??"")+")"),o=expressionToString({expression:expression.input,addHtml:addHtml});const p=expression.color,i=hsvToRgb(p.h,p.s,p.v*r),a=convertColor(browserSupportsP3,browserSupportsRec2020,...i);t=""+n+o;return expression.shorthandText?addHtml?`<span style="color: ${a}">${e.slice(1)}${expression.shorthandText}${s.slice(1)}</span>`:""+e.slice(1)+expression.shorthandText+s.slice(1):addHtml?`<span style="color: ${a}">${e}</span>${t}<span style="color: ${a}">${s}</span>`:e+t+s}onmessage=e=>{var s=expressionToString({...e.data,addHtml:!1}),r=expressionToString({...e.data,addHtml:!0});postMessage({text:s,html:r})};