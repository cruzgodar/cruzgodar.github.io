import{parseNaturalGlsl}from"../../../scripts/applets/applet.min.js";import{showPage}from"../../../scripts/src/loadPage.min.js";import{VectorFields}from"./class.min.js";import{DownloadButton,GenerateButton}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{Dropdown}from"/scripts/src/dropdowns.min.js";import{$}from"/scripts/src/main.min.js";import{siteSettings}from"/scripts/src/settings.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{TextBox}from"/scripts/src/textBoxes.min.js";import{Textarea}from"/scripts/src/textareas.min.js";export default function(){const t=new VectorFields({canvas:$("#output-canvas")}),n=(t.loadPromise.then(()=>u()),new TextBox({element:$("#resolution-input"),name:"Resolution",value:750,minValue:100,maxValue:1500,onInput:u})),a=new TextBox({element:$("#max-particles-input"),name:"Particles",value:1e4,minValue:1e3,maxValue:2e4,onInput:d}),i=new TextBox({element:$("#lifetime-input"),name:"Particle Lifetime",value:150,minValue:50,onInput:d}),s=new Checkbox({element:$("#raw-glsl-checkbox"),name:"Use raw GLSL"}),e={sourcesAndSinks:"((0.6x - 1)(0.6x + 1), (0.6y + 1)(0.6y - 1))",saddlePoints:"(0.49y^2, 1 - 0.49x^2)",clockwork:"(sin(1.5y), -sin(1.5x))",directionField:"(1, sin(y) / (x^2 + 1))",divergingDiamond:"(sin(y / 2.5), tan(x / 2.5))",draggables:"(draggableArg.x * x - y, x + draggableArg.y * y)"},o={sourcesAndSinks:"((0.6 * x - 1.0) * (0.6 * x + 1.0), (0.6 * y + 1.0) * (0.6 * y - 1.0))",saddlePoints:"(0.49 * y * y, 1.0 - 0.49 * x * x)",clockwork:"(sin(1.5 * y), -sin(1.5 * x))",directionField:"(1.0, sin(y) / (x * x + 1.0))",divergingDiamond:"(sin(y / 2.5), tan(x / 2.5))",draggables:"(draggableArg.x * x - y, x + draggableArg.y * y)"},r=new Dropdown({element:$("#examples-dropdown"),name:"Examples",options:{sourcesAndSinks:"Sources and Sinks",saddlePoints:"Saddle Points",clockwork:"Clockwork",directionField:"Direction Field",divergingDiamond:"Diverging Diamond",draggables:"Draggables"},onInput:function(){r.value&&(l.setValue((s.checked?o:e)[r.value]),u())}}),l=new Textarea({element:$("#glsl-textarea"),name:"Generating Code",value:"(sin(1.5y), -sin(1.5x))",onInput:()=>{r.value&&r.setValue({newValue:"default"})},onEnter:u}),m=(new GenerateButton({element:$("#generate-button"),onClick:u}),new DownloadButton({element:$("#download-button"),applet:t,filename:"a-vector-field.png"}),new Slider({element:$("#speed-slider"),name:"Simulation Speed",value:1,min:.5,max:3,snapPoints:[1],logarithmic:!0,onInput:function(){var e=m.value/300;t.dt=e}}));function u(){var e=s.checked?l.value:parseNaturalGlsl(l.value);t.run({generatingCode:e,resolution:n.value*siteSettings.resolutionMultiplier,maxParticles:Math.max(a.value,100),dt:m.value/300,lifetime:Math.min(i.value,255),worldCenterX:0,worldCenterY:0,zoomLevel:.5})}function d(){t.generateNewField({resolution:n.value*siteSettings.resolutionMultiplier,maxParticles:Math.max(a.value,100),dt:m.value/300,lifetime:Math.min(i.value,255)})}showPage()}