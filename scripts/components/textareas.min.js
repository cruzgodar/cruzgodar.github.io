import{addTemporaryParam,pageUrl}from"../src/main.min.js";import{InputElement}from"./inputElement.min.js";class Textarea extends InputElement{defaultValue;overlayElement;syncOverlay;constructor({element,name,value="",persistState=!0,syncOverlay=!0,allowEnter=!1,onInput=()=>{},onEnter=()=>{}}){if(super({element:element,name:name}),this.element.parentElement.nextElementSibling.textContent=this.name,this.overlayElement=this.element.nextElementSibling,this.value=value,this.persistState=persistState,this.syncOverlay=syncOverlay,this.allowEnter=allowEnter,this.onInput=onInput,this.onEnter=onEnter,this.element.value=this.value,this.updateOverlayElement(),this.element.addEventListener("input",()=>this.inputCallback()),this.element.addEventListener("keydown",e=>{"Enter"!==e.key||this.allowEnter&&!(e.shiftKey||e.metaKey||e.ctrlKey)||(e.preventDefault(),this.disabled)||this.onEnter()}),new ResizeObserver(()=>{this.updateOverlayElement()}).observe(this.element),this.persistState){const value=new URLSearchParams(window.location.search).get(this.element.id);value?setTimeout(()=>{this.setValue(decodeURIComponent(value),!0),this.loadResolve()},10):this.loadResolve(),addTemporaryParam(this.element.id)}else this.loadResolve()}updateOverlayElement(){this.syncOverlay&&(this.overlayElement.innerHTML=this.value.replaceAll(/</g,"&lt;")),this.element.style.height="fit-content",this.overlayElement.style.height=this.element.scrollHeight+"px",this.overlayElement.style.width=this.element.scrollWidth+"px",this.overlayElement.style.left=this.element.offsetLeft+"px",this.element.style.height=this.element.scrollHeight+"px",setTimeout(()=>{for(const e of Array.from(this.overlayElement.children).filter(element=>!element.textContent))e.remove()},50)}inputCallback(){this.disabled||this.setValue(this.element.value,!0)}setValue(newValue,callOnInput=!1){var e;this.value=newValue,this.element.value=this.value,this.updateOverlayElement(),this.persistState&&(e=new URLSearchParams(window.location.search),this.value&&e.set(this.element.id,encodeURIComponent(this.value)),e=e.toString(),window.history.replaceState({url:pageUrl},"",pageUrl.replace(/\/home/,"")+"/"+(e?"?"+e:""))),callOnInput&&this.onInput()}}export{Textarea};