import{AnimationFrameApplet}from"./animationFrameApplet.min.js";import{RaymarchApplet}from"./raymarchApplet.min.js";import*as THREE from"/scripts/three.js";class ThreeApplet extends AnimationFrameApplet{movingSpeed=.1;moveVelocity=[0,0,0];moveFriction=.96;moveStopThreshhold=.01;lastTimestamp=-1;theta=0;phi=0;imageSize=400;imageWidth=400;imageHeight=400;imagePlaneCenterPos=[];forwardVec=[];rightVec=[];upVec=[];cameraPos=[0,0,0];renderer;scene;camera;constructor(canvas){super(canvas),this.listenForKeysPressed(["w","s","a","d","q","e"," ","shift"]);const e=setInterval(()=>{this?.wilson?.draggables?.container&&(this.listenForNumTouches(),clearInterval(e))},100)}initThree(){this.scene=new THREE.Scene,this.scene.background=new THREE.Color(0),this.camera=new THREE.PerspectiveCamera(100,1,.01,100),this.renderer=new THREE.WebGLRenderer({canvas:this.wilson.canvas,antialias:!0,context:this.wilson.gl}),this.renderer.setSize(this.imageSize,this.imageSize,!1),this.ambientLight=new THREE.AmbientLight(16777215,.15),this.scene.add(this.ambientLight),this.pointLight=new THREE.PointLight(16777215,1,1e4),this.pointLight.position.set(750,1e3,500),this.scene.add(this.pointLight),this.renderer.useLegacyLights=!0}calculateVectors(){this.forwardVec=[Math.cos(this.theta)*Math.sin(this.phi),Math.sin(this.theta)*Math.sin(this.phi),Math.cos(this.phi)],this.rightVec=RaymarchApplet.normalize([this.forwardVec[1],-this.forwardVec[0],0]),this.upVec=RaymarchApplet.crossProduct(this.rightVec,this.forwardVec),this.camera.position.set(0,0,0),this.camera.up.set(...this.upVec),this.camera.lookAt(...this.forwardVec),this.camera.position.set(...this.cameraPos)}moveUpdate(timeElapsed){var e;this.keysPressed.w||2===this.numTouches?this.moveVelocity[0]=1:!this.keysPressed.s&&3!==this.numTouches||(this.moveVelocity[0]=-1),this.keysPressed.d?this.moveVelocity[1]=1:this.keysPressed.a&&(this.moveVelocity[1]=-1),this.keysPressed[" "]?this.moveVelocity[2]=1:this.keysPressed.shift&&(this.moveVelocity[2]=-1),0===this.moveVelocity[0]&&0===this.moveVelocity[1]&&0===this.moveVelocity[2]||(e=[this.moveVelocity[0]*this.forwardVec[0]+this.moveVelocity[1]*this.rightVec[0],this.moveVelocity[0]*this.forwardVec[1]+this.moveVelocity[1]*this.rightVec[1],this.moveVelocity[0]*this.forwardVec[2]+this.moveVelocity[1]*this.rightVec[2]+this.moveVelocity[2]],this.cameraPos[0]+=this.movingSpeed*e[0]*(timeElapsed/6.944),this.cameraPos[1]+=this.movingSpeed*e[1]*(timeElapsed/6.944),this.cameraPos[2]+=this.movingSpeed*e[2]*(timeElapsed/6.944),this.needNewFrame=!0),this.calculateVectors();for(let t=0;t<3;t++)this.moveVelocity[t]*=this.moveFriction**(timeElapsed/6.944),Math.abs(this.moveVelocity[t])<this.moveStopThreshhold&&(this.moveVelocity[t]=0)}}export{ThreeApplet};