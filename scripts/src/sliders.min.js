import{InputElement}from"./inputElement.min.js";import{addTemporaryParam,pageUrl}from"./main.min.js";class Slider extends InputElement{subtextElement;valueElement;value;min;max;snapPoints;snapThreshhold;precision;logarithmic;integer;persistState;onInput;constructor({element,name,value,min,max,snapThreshhold=(max-min)/80,snapPoints=[],logarithmic=!1,integer=!1,persistState=!0,onInput=()=>{}}){if(super({element:element,name:name}),this.subtextElement=this.element.nextElementSibling.firstElementChild,this.logarithmic=logarithmic,this.integer=integer,this.value=parseFloat(value),this.min=parseFloat(min),this.max=parseFloat(max),this.snapPoints=snapPoints,this.snapThreshhold=snapThreshhold,this.logarithmic&&(this.value=Math.log10(this.value),this.min=Math.log10(this.min),this.max=Math.log10(this.max)),this.persistState=persistState,this.onInput=onInput,this.precision=Math.max(0,3-Math.floor(Math.log10((this.logarithmic?10**this.max:this.max)-(this.logarithmic?10**this.min:this.min)))),this.value=this.logarithmic?10**this.value:this.value,this.value=this.integer?Math.round(this.value):this.value.toFixed(this.precision),this.element.setAttribute("min",this.min),this.element.setAttribute("max",this.max),this.element.setAttribute("value",this.logarithmic?Math.log10(value):value),this.subtextElement.textContent=name+": ",this.valueElement=document.createElement("span"),this.valueElement.textContent=this.value,this.subtextElement.appendChild(this.valueElement),this.value=parseFloat(this.value),this.element.addEventListener("input",()=>{var t=this.value;this.value=this.logarithmic?10**parseFloat(this.element.value):parseFloat(this.element.value);for(let e=0;e<this.snapPoints.length;e++)Math.abs(this.value-this.snapPoints[e])<this.snapThreshhold&&(this.value=this.snapPoints[e]);this.value=this.integer?Math.round(this.value):this.value.toFixed(this.precision),this.valueElement.textContent=this.value,this.value=parseFloat(this.value),t!==this.value&&this.onInput()}),this.element.addEventListener("pointerup",()=>{var t;this.persistState&&(t=new URLSearchParams(window.location.search),void 0!==this.element.value&&t.set(this.element.id,encodeURIComponent(this.element.value)),t=t.toString(),window.history.replaceState({url:pageUrl},"",pageUrl.replace(/\/home/,"")+"/"+(t?"?"+t:"")))}),this.persistState){const value=new URLSearchParams(window.location.search).get(this.element.id);value&&setTimeout(()=>this.setValue(parseFloat(decodeURIComponent(value)),!0),10),addTemporaryParam(this.element.id)}}setValue(newValue,callOnInput=!1){var t;this.element.value=newValue,this.value=this.logarithmic?10**parseFloat(this.element.value):parseFloat(this.element.value),this.value=this.integer?Math.round(this.value):this.value.toFixed(this.precision),this.valueElement.textContent=this.value,this.persistState&&(t=new URLSearchParams(window.location.search),void 0!==this.element.value&&t.set(this.element.id,encodeURIComponent(this.element.value)),t=t.toString(),window.history.replaceState({url:pageUrl},"",pageUrl.replace(/\/home/,"")+"/"+(t?"?"+t:""))),callOnInput&&this.onInput()}setBounds({min=this.min,max=this.max,callOnInput=!1}){if(max<min)throw new Error(`Minimum slider value of ${min} is larger than maximum of ${max}!`);this.min=min,this.max=max,this.precision=Math.max(0,3-Math.floor(Math.log10((this.logarithmic?10**this.max:this.max)-(this.logarithmic?10**this.min:this.min)))),this.element.setAttribute("min",this.min),this.element.setAttribute("max",this.max),this.value>this.max?this.setValue(this.max,callOnInput):this.value<this.min&&this.setValue(this.min,callOnInput)}}export{Slider};