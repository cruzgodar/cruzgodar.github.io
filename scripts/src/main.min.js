import{cardContainer,openCard}from"./cards.min.js";import{addHeader}from"./header.min.js";import{initInteractionListeners}from"./interaction.min.js";import{initOnResize}from"./layout.min.js";import{redirect}from"./navigation.min.js";import{initCapsuleHeader,initDarkTheme,initIncreaseContrast,initReduceMotion,setScroll,siteSettings}from"./settings.min.js";import{sleep}from"./utils.min.js";const blockCardPages=["/gallery"];let pageElement=document.createElement("div"),$=queryString=>pageElement.querySelector(queryString),$$=queryString=>pageElement.querySelectorAll(queryString);const raw=String.raw;function updatePageElement(){pageElement=document.body.querySelector(".page"),$=queryString=>pageElement.querySelector(queryString),$$=queryString=>pageElement.querySelectorAll(queryString)}const params=new URLSearchParams(document.location.search);let pageUrl=decodeURIComponent(params.get("page")).replace("index.html","");function setPageUrl(newPageUrl){pageUrl=newPageUrl}"null"===(pageUrl="/"===pageUrl[pageUrl.length-1]?pageUrl.slice(0,-1):pageUrl)&&(pageUrl="/home");let temporaryListeners=[];function addTemporaryListener({object,event,callback,options={}}){object.addEventListener(event,callback,options),temporaryListeners.push([object,event,callback])}function clearTemporaryListeners(){temporaryListeners=[]}let temporaryIntervals=[];function addTemporaryInterval(refreshId){temporaryIntervals.push(refreshId)}function clearTemporaryIntervals(){temporaryIntervals=[]}let temporaryWorkers={};function addTemporaryWorker(src,id=src){temporaryWorkers[id]?.terminate&&temporaryWorkers[id].terminate();var e=window.DEBUG?src:src.replace(".js",".min.js"),e=new Worker(e);return temporaryWorkers[id]=e}function clearTemporaryWorkers(){temporaryWorkers={}}let temporaryParams=[];function addTemporaryParam(key){temporaryParams.push(key)}function clearTemporaryParams(){temporaryParams=[]}const scriptsLoaded={glsl:0};async function loadSite(url=pageUrl){if(await initDarkTheme(),initReduceMotion(),initIncreaseContrast(),initCapsuleHeader(),pageElement.classList.add("page"),document.body.insertBefore(pageElement,document.body.firstChild),initInteractionListeners(),initOnResize(),"scrollRestoration"in history&&(history.scrollRestoration="manual"),matchMedia("(display-mode: standalone)").matches){document.documentElement.style.WebkitUserSelect="none",document.documentElement.style.userSelect="none",document.documentElement.style.WebkitTouchCallout="none";for(const e of $$("body *"))e.setAttribute("draggable","false");addStyle(`
			#logo, .name-text-container, .empty-top
			{
				margin-top: 2vh;
			}
		`,!1)}window.addEventListener("popstate",e=>{-1===window.location.href.indexOf("#")&&redirect({url:e.state.url,noStatePush:!0,restoreScroll:!0})}),window.DEBUG||addStyle(".DEBUG {display: none;}",!1),addHeader(),pageUrl="",-1!==url.indexOf(".")?window.location.href=url:(await redirect({url:url,noStatePush:!0,noFadeOut:!0,noFadeIn:window.DEBUG}),showAndRestoreScroll(),window.DEBUG&&(setScroll(),setInterval(setScroll,1e3)))}function loadScript(src,isModule=!1){return new Promise((resolve,reject)=>{var e;scriptsLoaded[src]?resolve():(e=document.createElement("script"),isModule&&e.setAttribute("type","module"),document.body.appendChild(e),e.onload=()=>{scriptsLoaded[src]=!0,resolve()},e.onerror=reject,e.async=!0,e.src=src)})}function loadStyle(href){var e=document.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),document.head.appendChild(e),e.setAttribute("href",href),e}function addStyle(content,temporary=!0,atBeginningOfHead=!1){var e=document.createElement("style");return e.textContent=content,temporary&&e.classList.add("temporary-style"),atBeginningOfHead?document.head.insertBefore(e,document.head.firstChild):document.head.appendChild(e),e}async function showAndRestoreScroll(){const e=siteSettings.scroll;siteSettings.scroll=void 0,await sleep(10),siteSettings.card?blockCardPages.includes(pageUrl)?siteSettings.card=void 0:openCard({id:siteSettings.card,fromElement:pageElement,animationTime:10}).then(()=>{cardContainer.scrollTo(0,e),setTimeout(()=>{cardContainer.scrollTo(0,e)},100)}):(window.scrollTo(0,e),setTimeout(()=>window.scrollTo(0,e),100))}export{pageElement,$,$$,raw,updatePageElement,pageUrl,setPageUrl,temporaryListeners,addTemporaryListener,clearTemporaryListeners,temporaryIntervals,addTemporaryInterval,clearTemporaryIntervals,temporaryWorkers,addTemporaryWorker,clearTemporaryWorkers,temporaryParams,addTemporaryParam,clearTemporaryParams,loadSite,loadScript,loadStyle,addStyle};