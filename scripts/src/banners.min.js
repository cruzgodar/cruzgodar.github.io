import anime from"../anime.min.js";import{changeOpacity}from"./animation.min.js";import{headerElement}from"./header.min.js";import{likelyWindowChromeHeight,onResize,pageWidth,viewportHeight}from"./layout.min.js";import{$,addStyle,pageUrl}from"./main.min.js";import{siteSettings}from"./settings.min.js";let bannerElement,contentElement,bannerMaxScroll;function setBannerMaxScroll(newBannerMaxScroll){bannerMaxScroll=newBannerMaxScroll}let nameTextOpacity=1,lastBannerChangeTimestamp=-1,lastT=0;function easeInOutQuad(x){return x<.5?2*x*x:1-Math.pow(-2*x+2,2)/2}function updateBanner(timestamp){if(bannerElement&&contentElement&&timestamp!==lastBannerChangeTimestamp&&-1!==lastBannerChangeTimestamp){lastBannerChangeTimestamp=timestamp;var e=window.innerWidth<=500?8:16,n=Math.min(Math.max((window.innerWidth-pageWidth-2*e)/2,e),16),t=easeInOutQuad(Math.min(Math.max(window.scrollY/bannerMaxScroll*1.3,0),1));if(siteSettings.reduceMotion){var a=e+n;if(contentElement.style.paddingLeft=a+"px",contentElement.style.paddingRight=a+"px",contentElement.style.paddingTop=a+"px",contentElement.parentElement.style.marginLeft=`-${a}px`,contentElement.parentElement.style.marginRight=`-${a}px`,.8<=t&&lastT<.8){const r={t:0};anime({targets:r,t:1,duration:300,easing:"easeInOutSine",update:()=>{bannerElement.style.opacity=1-r.t,nameTextOpacity=1-r.t,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*(1-r.t)})`}})}else if(t<.8&&.8<=lastT){const l={t:0};anime({targets:l,t:1,duration:300,easing:"easeInOutSine",update:()=>{bannerElement.style.opacity=l.t,nameTextOpacity=l.t,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*l.t})`}})}}else contentElement.style.paddingLeft=e+t*n+"px",contentElement.style.paddingRight=e+t*n+"px",contentElement.style.paddingTop=e+t*e+"px",contentElement.parentElement.style.marginLeft=`-${e+n*t}px`,contentElement.parentElement.style.marginRight=`-${e+n*t}px`,contentElement.style.boxShadow=`0px 0px 16px 4px rgba(0, 0, 0, ${.35*(1-t)})`,bannerElement.style.opacity=1-t,nameTextOpacity=1-Math.min(1.5*t,1);contentElement.offsetHeight<viewportHeight-headerElement.offsetHeight-32?(contentElement.parentElement.style.marginBottom=(viewportHeight-headerElement.offsetHeight-contentElement.offsetHeight)/2+"px",setTimeout(()=>onResize(),16)):contentElement.parentElement.style.marginBottom=0,lastT=t}else lastBannerChangeTimestamp=timestamp;requestAnimationFrame(updateBanner)}requestAnimationFrame(updateBanner);let bannerFilename="",bannerFilepath="";const bannerPages=["/home","/about","/writing/mist","/writing/desolation-point","/debug/htmdl-test"],multibannerPages={"/home":{currentBanner:Math.floor(11*Math.random())+1,numBanners:11}};async function preloadBanner(url){bannerPages.includes(url)&&(bannerFilename="small.webp",bannerFilepath=url+"/banners/",url in multibannerPages&&(bannerFilepath+=multibannerPages[url].currentBanner+"/"),await new Promise(resolve=>{const e=document.createElement("img");e.onload=()=>{resolve()},setTimeout(()=>e.src=bannerFilepath+bannerFilename,0)}))}async function loadBanner({url,large=!1}){bannerPages.includes(url)&&(bannerElement=$("#banner"),(contentElement=$("#content"))?.parentElement&&(contentElement.parentElement.style.marginTop=`calc(100vh - ${likelyWindowChromeHeight+40}px)`),bannerFilename=`${large?"large":"small"}.webp`,bannerFilepath=url+"/banners/",url in multibannerPages&&(bannerFilepath+=multibannerPages[url].currentBanner+"/"),addStyle(`
		#banner-small
		{
			background: url(${bannerFilepath}small.webp) no-repeat center center;
			background-size: cover;
		}
		
		#banner-large
		{
			background: url(${bannerFilepath}large.webp) no-repeat center center;
			background-size: cover;
		}
	`),await new Promise(resolve=>{const e=document.createElement("img");e.onload=()=>{resolve()},setTimeout(()=>e.src=bannerFilepath+bannerFilename,0)}))}function initBanner(){bannerPages.includes(pageUrl)&&loadBanner({url:pageUrl,large:!0}).then(()=>{changeOpacity({element:$("#banner-small"),opacity:0,duration:700}).then(()=>$("#banner-small").remove())})}export{bannerElement,contentElement,setBannerMaxScroll,nameTextOpacity,updateBanner,bannerPages,multibannerPages,preloadBanner,loadBanner,initBanner};