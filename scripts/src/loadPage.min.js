import{fadeDownIn,fadeIn,fadeLeftIn,fadeRightIn,fadeUpIn,opacityAnimationTime}from"./animation.min.js";import{bannerElement,initBanner}from"./banners.min.js";import{initNavButtons,initTextButtons}from"./buttons.min.js";import{initCards,showCard}from"./cards.min.js";import{initCarousels}from"./carousels.min.js";import{initFocusEvents,initHoverEvents}from"./hoverEvents.min.js";import{loadImages}from"./images.min.js";import{listenForFullscreenKey}from"./interaction.min.js";import{equalizeAppletColumns,onResize}from"./layout.min.js";import{$$,asyncFetch,pageElement,pageUrl,updatePageElement}from"./main.min.js";import{typesetMath}from"./math.min.js";import{navigationTransitionType,redirect,setCurrentlyRedirecting}from"./navigation.min.js";import{initPageContents}from"./pageContent.min.js";import{siteSettings}from"./settings.min.js";import{sitemap}from"./sitemap.min.js";const blockCardPages=["/gallery/"];let pageShown=!0;async function loadPage(){pageShown=!1,window.dispatchEvent(new Event("scroll")),updatePageElement();var e=document.head.querySelector("title");e&&(e.textContent=sitemap[pageUrl].title),initBanner(),await loadCustomStyle(),loadCustomScripts(),setLinks(),disableLinks(),initHoverEvents(),initTextButtons(),initNavButtons(),initPageContents(),initCarousels(),loadImages(),typesetMath(),initCards(),onResize(),listenForFullscreenKey(),setTimeout(initFocusEvents,50),setTimeout(equalizeAppletColumns,50),setTimeout(equalizeAppletColumns,100)}async function showPage(){await new Promise(resolve=>setTimeout(resolve,10)),siteSettings.card&&(blockCardPages.includes(pageUrl)?siteSettings.card=void 0:showCard({id:siteSettings.card,fromElement:pageElement,animationTime:10})),await fadeInPage(),setCurrentlyRedirecting(!1)}async function loadCustomStyle(){var e;sitemap[pageUrl].customStyle&&((e=document.createElement("style")).textContent=await asyncFetch(pageUrl+"style/index."+(window.DEBUG?"css":"min.css")),e.classList.add("temporary-style"),document.head.insertBefore(e,document.head.firstChild))}function loadCustomScripts(){sitemap[pageUrl].customScript?import(pageUrl+"scripts/index."+(window.DEBUG?"js":"min.js")).then(Module=>Module.default()):requestAnimationFrame(showPage)}async function fadeInPage(){fadeIn({element:document.querySelector("#header")}),document.querySelector("#header-container").style.opacity=1,setTimeout(()=>pageShown=!0,10),opacityAnimationTime?await(1===navigationTransitionType?bannerElement?Promise.all([fadeUpIn({element:bannerElement}),fadeUpIn({element:pageElement})]):fadeUpIn({element:pageElement}):-1===navigationTransitionType?bannerElement?Promise.all([fadeDownIn({element:bannerElement}),fadeDownIn({element:pageElement})]):fadeDownIn({element:pageElement}):2===navigationTransitionType?bannerElement?Promise.all([fadeLeftIn({element:bannerElement}),fadeLeftIn({element:pageElement})]):fadeLeftIn({element:pageElement}):-2===navigationTransitionType?bannerElement?Promise.all([fadeRightIn({element:bannerElement}),fadeRightIn({element:pageElement})]):fadeRightIn({element:pageElement}):bannerElement?Promise.all([fadeIn({element:bannerElement}),fadeIn({element:pageElement})]):fadeIn({element:pageElement})):(pageElement.style.opacity=1,bannerElement&&(bannerElement.style.opacity=1))}function setLinks(){$$("a:not([data-card-id])").forEach(link=>{const t=link.getAttribute("href");if(t){const n=!("https"!==t.slice(0,5)&&"data"!==t.slice(0,4)&&1!=link.getAttribute("data-in-new-tab"));link.addEventListener("click",e=>{redirect({url:t,inNewTab:n||e.metaKey})})}}),$$("a[data-card-id]").forEach(link=>{const t=link.getAttribute("href");t&&link.addEventListener("click",e=>{e.metaKey&&redirect({url:t,inNewTab:!0})})})}function disableLinks(){$$("a:not(.real-link)").forEach(link=>{link.addEventListener("click",e=>e.preventDefault())})}export{pageShown,loadPage,showPage,disableLinks};