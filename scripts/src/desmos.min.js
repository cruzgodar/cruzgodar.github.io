import{changeOpacity}from"./animation.min.js";import{loadScript,raw}from"./main.min.js";import{siteSettings}from"./settings.min.js";let desmosPurple="#772fbf",desmosBlue="#2f77bf",desmosRed="#bf2f2f",desmosOrange="#bf772f";const desmosBlack="#000000",desmosPurple3d="#772fbf",desmosBlue3d="#2f77bf",desmosRed3d="#bf2f2f",desmosOrange3d="#bf772f",desmosGray3d="#777777";function updateDesmosColors(){desmosPurple=siteSettings.darkTheme?"#60c000":"#772fbf",desmosBlue=siteSettings.darkTheme?"#c06000":"#2f77bf",desmosRed=siteSettings.darkTheme?"#00c0c0":"#bf2f2f",desmosOrange=siteSettings.darkTheme?"#3f9fff":"#bf772f"}let desmosGraphs={};function clearDesmosGraphs(){desmosGraphs={}}let getDesmosData=()=>({});function setGetDesmosData(newGetDesmosData){getDesmosData=newGetDesmosData}async function createDesmosGraphs(recreating=!1){if(!window.OFFLINE){await loadScript("/scripts/desmos.min.js");for(const d in desmosGraphs)desmosGraphs[d]?.destroy&&desmosGraphs[d].destroy();desmosGraphs={},updateDesmosColors();var s=getDesmosData();for(const n in s){var t=!s[n].use3d;for(const m of s[n].expressions)m.latex=m.latex.replace(/\(/g,raw`\left(`),m.latex=m.latex.replace(/\)/g,raw`\right)`),m.latex=m.latex.replace(/\[/g,raw`\left[`),m.latex=m.latex.replace(/\]/g,raw`\right]`),t&&(m.lineWidth??=3.5)}for(const l of document.body.querySelectorAll(".desmos-container")){let e=!1;for(const c of s[l.id].expressions)if(!c.secret){e=!0;break}var o,r={keypad:!1,settingsMenu:!1,zoomButtons:!1,showResetButtonOnGraphpaper:!0,border:!1,expressionsCollapsed:!0,invertedColors:siteSettings.darkTheme,xAxisMinorSubdivisions:1,yAxisMinorSubdivisions:1,expressions:e,...s[l.id].options??{}},i=s[l.id].use3d?Desmos.Calculator3D:Desmos.GraphingCalculator,i=(desmosGraphs[l.id]=i(l,r),s[l.id].bounds),a=l.getBoundingClientRect(),a=a.width/a.height;void 0===i.xmin&&void 0!==i.left&&(i.xmin=i.left,delete i.left),void 0===i.xmax&&void 0!==i.right&&(i.xmax=i.right,delete i.right),void 0===i.ymin&&void 0!==i.bottom&&(i.ymin=i.bottom,delete i.bottom),void 0===i.ymax&&void 0!==i.top&&(i.ymax=i.top,delete i.top),void 0!==r.showPlane3D&&(desmosGraphs[l.id].controller.graphSettings.showPlane3D=r.showPlane3D),s[l.id].use3d||(r=i.xmax-i.xmin,o=(i.xmin+i.xmax)/2,i.xmin=o-r/2*a,i.xmax=o+r/2*a),desmosGraphs[l.id].setMathBounds(i),desmosGraphs[l.id].setExpressions(s[l.id].expressions),desmosGraphs[l.id].controller.graphSettings.showBox3D=!1,desmosGraphs[l.id].updateSettings({}),desmosGraphs[l.id].setDefaultState(desmosGraphs[l.id].getState()),window.DEBUG&&!recreating&&l.addEventListener("click",e=>{e.metaKey&&getDesmosScreenshot(l.id,e.altKey)})}}}async function recreateDesmosGraphs(){var e=Array.from(document.body.querySelectorAll(".desmos-container"));e&&(await Promise.all(e.map(element=>changeOpacity({element:element,opacity:0}))),await createDesmosGraphs(!0),await Promise.all(e.map(element=>changeOpacity({element:element,opacity:1}))))}function getDesmosScreenshot(id,forPdf=!1){if(desmosGraphs[id].controller.graphSettings.showPlane3D=!1,desmosGraphs[id].controller.graphSettings.showNumbers3D=forPdf,desmosGraphs[id].controller.graphSettings.showAxisLabels3D=forPdf,desmosGraphs[id].updateSettings({showGrid:forPdf,xAxisNumbers:forPdf,yAxisNumbers:forPdf}),!desmosGraphs[id].getState().graph.threeDMode){var s=desmosGraphs[id].getExpressions();for(let e=0;e<s.length;e++)s[e].lineWidth=forPdf?2.5:15,s[e].pointSize=forPdf?10:50,s[e].dragMode="NONE";desmosGraphs[id].setExpressions(s)}var e=desmosGraphs[id].screenshot({width:400,height:400,targetPixelRatio:8}),t=document.createElement("img");t.width=4e3,t.height=4e3,t.style.width="50vmin",t.style.height="50vmin",t.src=e,document.body.appendChild(t)}let uid=0;function getDesmosPoint({point,color,dragMode="XY",style="POINT",secret=!0}){return[{latex:raw`(${point[0]}, ${point[1]})`,dragMode:dragMode,pointStyle:style,color:color,secret:secret}]}function getDesmosSlider({expression,min,max,step,secret=!0}){return[{latex:raw`${expression}`,sliderBounds:{min:min,max:max,step:step},secret:secret}]}function getDesmosVector({from,to,color,secret=!0,lineStyle="SOLID"}){return uid++,[{latex:raw`((${from[0]}), (${from[1]})), ((${to[0]}), (${to[1]}))`,color:color,lines:!0,points:!1,secret:secret,lineStyle:lineStyle},{latex:raw`s_{${uid}} = \arctan(${to[1]} - (${from[1]}), ${to[0]} - (${from[0]}))`,secret:secret},{latex:raw`((${to[0]}), (${to[1]})), ((${to[0]}) - .35\cos(s_{${uid}} + .5), (${to[1]}) - .35\sin(s_{${uid}} + .5))`,color:color,lines:!0,points:!1,secret:secret},{latex:raw`((${to[0]}), (${to[1]})), ((${to[0]}) - .35\cos(s_{${uid}} - .5), (${to[1]}) - .35\sin(s_{${uid}} - .5))`,color:color,lines:!0,points:!1,secret:secret}]}export{desmosPurple,desmosBlue,desmosRed,desmosOrange,desmosBlack,desmosPurple3d,desmosBlue3d,desmosRed3d,desmosOrange3d,desmosGray3d,desmosGraphs,clearDesmosGraphs,setGetDesmosData,createDesmosGraphs,recreateDesmosGraphs,getDesmosScreenshot,getDesmosPoint,getDesmosSlider,getDesmosVector};