import{changeOpacity}from"./animation.min.js";import{loadScript,raw}from"./main.min.js";import{siteSettings}from"./settings.min.js";const desmosPurple="_desmosPurple",desmosBlue="_desmosBlue",desmosRed="_desmosRed",desmosOrange="_desmosOrange",desmosBlack="_desmosBlack",desmosGray="_desmosGray",functionsForColors={[desmosPurple]:(is3d,alwaysDark)=>!is3d&&(siteSettings.darkTheme||alwaysDark)?"#66cc00":"#7f32cc",[desmosBlue]:(is3d,alwaysDark)=>!is3d&&(siteSettings.darkTheme||alwaysDark)?"#cc6600":"#327fcc",[desmosRed]:(is3d,alwaysDark)=>!is3d&&(siteSettings.darkTheme||alwaysDark)?"#00cccc":"#cc3232",[desmosOrange]:(is3d,alwaysDark)=>!is3d&&(siteSettings.darkTheme||alwaysDark)?"#0066cc":"#cc7f32",[desmosBlack]:is3d=>{if(is3d)throw new Error("desmosBlack is not a valid color for 3d graphs");return"#000000"},[desmosGray]:is3d=>{if(is3d)return"#777777";throw new Error("desmosGray is not a valid color for 2d graphs")}};let desmosGraphs={},desmosGraphsDefaultState={};function clearDesmosGraphs(){desmosGraphs={},desmosGraphsDefaultState={}}let desmosData={};async function createDesmosGraphs(desmosDataInitializer=desmosData,recreating=!1){if(!window.OFFLINE){await loadScript("/scripts/desmos.min.js");for(const d in desmosGraphs)desmosGraphs[d]?.destroy&&(desmosGraphs[d].destroy(),delete desmosGraphs[d],delete desmosGraphsDefaultState[d]);desmosData=desmosDataInitializer;var s=structuredClone(desmosData);for(const l in s){var o=s[l].use3d;for(const n of s[l].expressions)n.color&&(n.color=functionsForColors[n.color](o,s[l].alwaysDark)),n.latex&&(n.latex=n.latex.replace(/\(/g,raw`\left(`),n.latex=n.latex.replace(/\)/g,raw`\right)`),n.latex=n.latex.replace(/\[/g,raw`\left[`),n.latex=n.latex.replace(/\]/g,raw`\right]`),n.latex=n.latex.replace(/([^\\left])\\\{/g,(match,$1)=>raw`${$1}\left\{`),n.latex=n.latex.replace(/([^\\right])\\\}/g,(match,$1)=>raw`${$1}\right\}`),o||(n.lineWidth??=3.5))}for(const m of document.body.querySelectorAll(".desmos-container")){let e=!1;for(const c of s[m.id].expressions)if(!c.secret){e=!0;break}var t,r={keypad:!1,settingsMenu:!1,zoomButtons:!1,showResetButtonOnGraphpaper:!0,border:!1,expressionsCollapsed:!0,invertedColors:siteSettings.darkTheme||s[m.id].alwaysDark,xAxisMinorSubdivisions:1,yAxisMinorSubdivisions:1,expressions:e,colors:{PURPLE:functionsForColors[desmosPurple](s[m.id].use3d,s[m.id].alwaysDark),BLUE:functionsForColors[desmosBlue](s[m.id].use3d,s[m.id].alwaysDark),RED:functionsForColors[desmosRed](s[m.id].use3d,s[m.id].alwaysDark),ORANGE:functionsForColors[desmosOrange](s[m.id].use3d,s[m.id].alwaysDark),...s[m.id].use3d?{BLACK:functionsForColors[desmosGray](s[m.id].use3d,s[m.id].alwaysDark)}:{BLACK:functionsForColors[desmosBlack](s[m.id].use3d,s[m.id].alwaysDark)}},...s[m.id].options??{}},a=s[m.id].use3d?Desmos.Calculator3D:Desmos.GraphingCalculator,a=(desmosGraphs[m.id]=a(m,r),s[m.id].bounds),i=m.getBoundingClientRect(),i=i.width/i.height;void 0===a.xmin&&void 0!==a.left&&(a.xmin=a.left,delete a.left),void 0===a.xmax&&void 0!==a.right&&(a.xmax=a.right,delete a.right),void 0===a.ymin&&void 0!==a.bottom&&(a.ymin=a.bottom,delete a.bottom),void 0===a.ymax&&void 0!==a.top&&(a.ymax=a.top,delete a.top),void 0!==r.showPlane3D&&(desmosGraphs[m.id].controller.graphSettings.showPlane3D=r.showPlane3D),s[m.id].use3d||(r=a.xmax-a.xmin,t=(a.xmin+a.xmax)/2,a.xmin=t-r/2*i,a.xmax=t+r/2*i),desmosGraphs[m.id].setMathBounds(a),desmosGraphs[m.id].setExpressions(s[m.id].expressions),desmosGraphs[m.id].controller.graphSettings.showBox3D=!1,desmosGraphs[m.id].updateSettings({}),desmosGraphsDefaultState[m.id]=desmosGraphs[m.id].getState(),desmosGraphs[m.id].setDefaultState(desmosGraphsDefaultState[m.id]),window.DEBUG&&!recreating&&m.addEventListener("click",e=>{e.metaKey&&getDesmosScreenshot(m.id,e.altKey)})}}}async function recreateDesmosGraphs(){var e=Array.from(document.body.querySelectorAll(".desmos-container"));e&&(await Promise.all(e.map(element=>changeOpacity({element:element,opacity:0}))),await createDesmosGraphs(desmosData),await Promise.all(e.map(element=>changeOpacity({element:element,opacity:1}))))}async function getDesmosScreenshot(id,forPdf=!1){desmosGraphs[id].controller.graphSettings.showPlane3D=!1,desmosGraphs[id].controller.graphSettings.showNumbers3D=forPdf,desmosGraphs[id].controller.graphSettings.showAxisLabels3D=forPdf,desmosGraphs[id].updateSettings({showGrid:forPdf,xAxisNumbers:forPdf,yAxisNumbers:forPdf});var e=desmosGraphs[id].getState().graph.threeDMode;if(!e){var s=desmosGraphs[id].getExpressions();for(let e=0;e<s.length;e++)s[e].lineWidth=forPdf?5:30,s[e].pointSize=forPdf?10:50,s[e].dragMode="NONE";desmosGraphs[id].setExpressions(s)}var e=e?desmosGraphs[id].screenshot({width:800,height:800,targetPixelRatio:4}):await new Promise(resolve=>{desmosGraphs[id].asyncScreenshot({width:800,height:800,targetPixelRatio:4,showLabels:forPdf},resolve)}),o=document.createElement("img");o.width=500,o.height=500,o.style.width="50vmin",o.style.height="50vmin",o.src=e,document.body.appendChild(o)}let uid=0;function getDesmosPoint({point,color,dragMode="XY",style="POINT",secret=!0,size=9}){return[{latex:raw`(${point[0]}, ${point[1]})`,dragMode:dragMode,pointStyle:style,color:color,secret:secret,pointSize:size}]}function getDesmosSlider({expression,min,max,step,secret=!0}){return[{latex:raw`${expression}`,sliderBounds:{min:min,max:max,step:step},secret:secret}]}function getDesmosVector({from,to,color,secret=!0,lineStyle="SOLID",arrowSize="0.35"}){return uid++,[{latex:raw`((${from[0]}), (${from[1]})), ((${to[0]}), (${to[1]}))`,color:color,lines:!0,points:!1,secret:secret,lineStyle:lineStyle},{latex:raw`s_{${uid}} = \arctan(${to[1]} - (${from[1]}), ${to[0]} - (${from[0]}))`,secret:secret},{latex:raw`((${to[0]}), (${to[1]})), ((${to[0]}) - ${arrowSize}\cos(s_{${uid}} + .5), (${to[1]}) - ${arrowSize}\sin(s_{${uid}} + .5))`,color:color,lines:!0,points:!1,secret:secret},{latex:raw`((${to[0]}), (${to[1]})), ((${to[0]}) - ${arrowSize}\cos(s_{${uid}} - .5), (${to[1]}) - ${arrowSize}\sin(s_{${uid}} - .5))`,color:color,lines:!0,points:!1,secret:secret}]}export{desmosPurple,desmosBlue,desmosRed,desmosOrange,desmosBlack,desmosGray,desmosGraphs,desmosGraphsDefaultState,clearDesmosGraphs,createDesmosGraphs,recreateDesmosGraphs,getDesmosScreenshot,getDesmosPoint,getDesmosSlider,getDesmosVector};