import anime from"../anime.min.js";import{cardAnimationTime}from"./animation.min.js";import{addHoverEventWithScale}from"./hoverEvents.min.js";import{$,$$,pageElement}from"./main.min.js";import{siteSettings}from"./settings.min.js";const contentsSelector=".notes-title, .section-text, .heading-text";let contentsContainerElement,contentsElement,indicatorElement,contentsShown=!1,contentsAnimating=!1;function initPageContents(){const n=$(".nav-buttons");n&&(prepareContents(),n.insertAdjacentHTML("afterend",`
		<div class="text-buttons nav-buttons contents-button-container" style="grid-template-columns: repeat(auto-fit, 88px);">
			<div class="focus-on-child" tabindex="1">
				<button class="text-button linked-text-button" type="button" tabindex="-1">Contents</button>
			</div>
		</div>
	`),n.classList.add("contents-container"),setTimeout(()=>{var t=n.nextElementSibling.firstElementChild;addHoverEventWithScale({element:t,scale:1.075,addBounceOnTouch:!1}),t.addEventListener("click",showContents)}))}function prepareContents(){(contentsContainerElement=document.createElement("div")).id="contents-container",pageElement.appendChild(contentsContainerElement),(contentsElement=document.createElement("div")).id="contents",contentsContainerElement.append(contentsElement),$$(contentsSelector).forEach(element=>{var t,n=element.cloneNode(!0);n.classList.contains("heading-text")&&-1!==(t=n.textContent.indexOf(":"))&&(n.textContent=n.textContent.slice(t+2)),contentsElement.appendChild(n),n.addEventListener("click",()=>{element.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),window.innerWidth<1e3&&hideContents()}),addHoverEventWithScale({element:n,scale:1.025,addBounceOnTouch:!1})}),contentsContainerElement.style.opacity=0,contentsContainerElement.style.marginRight=siteSettings.reduceMotion?0:"-32px",contentsContainerElement.style.display="none",(indicatorElement=document.createElement("img")).id="contents-indicator",indicatorElement.src="/graphics/general-icons/contents-indicator.png",pageElement.appendChild(indicatorElement),addHoverEventWithScale({element:indicatorElement,scale:1.1,addBounceOnTouch:!1}),indicatorElement.addEventListener("click",showContents)}async function showContents(){contentsShown||contentsAnimating||(contentsAnimating=!0,contentsShown=!0,contentsContainerElement.style.display="flex",await Promise.all([anime({targets:contentsContainerElement,opacity:1,marginRight:0,duration:cardAnimationTime,easing:"easeOutQuint"}).finished,anime({targets:indicatorElement,opacity:0,duration:cardAnimationTime,easing:"easeOutQuint"}).finished]),document.documentElement.addEventListener("click",handleClickEvent),contentsAnimating=!1)}async function hideContents(){contentsShown&&!contentsAnimating&&(contentsAnimating=!0,contentsShown=!1,document.documentElement.removeEventListener("click",handleClickEvent),await Promise.all([anime({targets:contentsContainerElement,opacity:0,marginRight:siteSettings.reduceMotion?0:"-32px",duration:cardAnimationTime,easing:"easeOutQuint"}).finished,anime({targets:indicatorElement,opacity:1,duration:cardAnimationTime,easing:"easeOutQuint"}).finished]),contentsContainerElement.style.display="none",contentsAnimating=!1)}function handleClickEvent(e){let t=e.target;for(;t!==pageElement;){if(t===contentsElement)return;t=t.parentElement}hideContents()}export{initPageContents};